servers = [
  {
    :hostname => "KaliLinux",
    :ip => "192.168.56.3",
    :box => "kalilinux/rolling",
    :box_version => "2024.2.0",
    :ram => 2048,
    :cpu => 4
  },
  {
    :hostname => "Metasploitable3",
    :ip => "192.168.56.2",
    :box => "rapid7/metasploitable3-win2k",
    :box_version => "0.1.0-weekly",
    :ram => 2048,
    :cpu => 4
  },
]



Vagrant.configure("2") do |config|
  servers.each do |machine|
    config.vm.define machine[:hostname] do |node|
      	node.vm.box = machine[:box]
      	node.vm.hostname = machine[:hostname]
		node.vm.box_version = machine[:box_version]
      	node.vm.communicator = "winrm"
      	node.vm.guest = :windows
      	node.vm.network "private_network", ip: machine[:ip]
      	node.vm.synced_folder ".", "/mnt/vagrant"

		node.vm.provider "virtualbox" do |vb|
	        vb.customize ["modifyvm", :id, "--memory", machine[:ram]]
	        vb.customize ["modifyvm", :id, "--cpus", machine[:cpu]]
	      end
	      node.vm.provider "vmware" do |vm|
	        vm.vmx["memsize"] = machine[:ram]
	        vm.vmx["numvcpus"] = machine[:cpu]
	      end
	      # Add any additional provisioning script if needed
	      # PowerShell provisioning script
  		# config.vm.provision "shell", path: "youscript.sh"
	    case node.vm.hostname
	    	when "KaliLinux"
	    		node.vm.provision "shell", privileged: true, inline: <<-SCRIPT
	      			echo "Hello World"
	      			sudo apt update && sudo apt upgrade -y
	   		SCRIPT
	   	end
    end
  end
end
